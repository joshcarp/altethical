
{{/* Automatically generated by https://github.com/anz-bank/sysl-catalog it is strongly recommended not to edit this file */}}
{{$packageName := ModulePackageName .}}
# {{$packageName}}
## Integration Diagram
<img src="{{CreateIntegrationDiagram . $packageName false}}">
{{$Apps := .Apps}}
{{$databases := false}}
{{range $appName := SortedKeys .Apps}}{{$app := index $Apps $appName}}{{if and (eq (hasPattern $app.Attrs "ignore") false) (eq (hasPattern $app.Attrs "db") true)}}
{{$databases = true}}
{{end}}{{end}}
{{if $databases}}
## Database Index
| Database Application Name  |
----|----{{range $appName := SortedKeys .Apps}}{{$app := index $Apps $appName}}{{if and (eq (hasPattern $app.Attrs "ignore") false) (eq (hasPattern $app.Attrs "db") true)}}
[{{$appName}}](#Database-{{$appName}})|  {{end}}{{end}}
{{end}}
## Application Index
{{$anyApps := false}}
{{$Apps := .Apps}}{{range $appName := SortedKeys .Apps}}{{$app := index $Apps $appName}}{{if eq (hasPattern $app.Attrs "ignore") false}}{{$Endpoints := $app.Endpoints}}{{range $endpointName := SortedKeys $Endpoints}}{{$endpoint := index $Endpoints $endpointName}}{{if eq (hasPattern $endpoint.Attrs "ignore") false}}{{if not $anyApps}}| Application Name | Method |
|----|----|{{$anyApps = true}}{{end}}
| {{$appName}} | [{{$endpoint.Name}}](#{{$appName}}-{{SanitiseOutputName $endpoint.Name}}) |{{end}}{{end}}{{end}}{{end}}
{{if not $anyApps}}
<span style="color:grey">No Applications Defined</span>
{{end}}
## Type Index
{{$anyTypes := false}}
{{range $appName := SortedKeys .Apps}}{{$app := index $Apps $appName}}{{$types := $app.Types}}{{if ne (hasPattern $app.Attrs "db") true}}{{range $typeName := SortedKeys $types}}{{$type := index $types $typeName}}{{if not $anyTypes}}| Application Name | Type Name |
|----|----|{{$anyTypes = true}}{{end}}
| {{$appName}} | [{{$typeName}}](#{{$appName}}.{{$typeName}}) | {{end}}{{end}}{{end}}
{{if not $anyTypes}}
<span style="color:grey">No Types Defined</span>
{{end}}
{{if $databases}}
# Databases
{{range $appName := SortedKeys .Apps}}{{$app := index $Apps $appName}}
{{if hasPattern $app.GetAttrs "db"}}
<a name=Database-{{$appName}}></a><details>
<summary>Database {{$appName}}</summary>

{{Attribute $app "description"}}

<img src="{{GenerateDataModel $app}}">
</details>


{{end}}{{end}}
{{end}}
{{if $anyApps}}
# Applications
{{range $appName := SortedKeys .Apps}}{{$app := index $Apps $appName}}
{{if eq (hasPattern $app.Attrs "ignore") false}}
{{if eq (hasPattern $app.Attrs "db") false}}
{{if ne (len $app.Endpoints) 0}}
## Application {{$appName}}
{{$desc := Attribute $app "description"}}
{{if $desc}}
- {{$desc}}
{{end}}
{{ServiceMetadata $app}}
{{with CreateRedoc $app.SourceContext $appName}}
[View OpenAPI Specs in Redoc]({{CreateRedoc $app.SourceContext $appName}})
{{end}}
{{range $e := $app.Endpoints}}
{{if eq (hasPattern $e.Attrs "ignore") false}}
### <a name={{$appName}}-{{SanitiseOutputName $e.Name}}></a>{{$appName}} {{$e.Name}}
{{Attribute $e "description"}}
<details>
<summary>Sequence Diagram</summary>

<img src="{{CreateSequenceDiagram $appName $e}}">

</details>


<details>
<summary>Request types</summary>
{{if and (not $e.Param) (not $e.RestParams) }}
<span style="color:grey">No Request types</span>
{{end}}
{{if not $e.Param}}{{if $e.RestParams }}{{if not $e.RestParams.UrlParam}}
<span style="color:grey">No Request types</span>
{{end}}{{end}}{{end}}
{{range $param := $e.Param}}
{{Attribute $param.Type "description"}}
<img src="{{CreateParamDataModel $app $param}}">
{{end}}
{{if $e.RestParams}}{{if $e.RestParams.UrlParam}}
{{range $param := $e.RestParams.UrlParam}}
{{$pathDataModel := (CreateParamDataModel $app $param)}}
{{if ne $pathDataModel ""}}
#### Path Parameter
<img src="{{$pathDataModel}}">
{{end}}{{end}}{{end}}
{{if $e.RestParams.QueryParam}}
{{range $param := $e.RestParams.QueryParam}}
{{$queryDataModel := (CreateParamDataModel $app $param)}}
{{if ne $queryDataModel ""}}
#### Query Parameter
<img src="{{$queryDataModel}}">
{{end}}{{end}}{{end}}{{end}}
</details>


<details>
<summary>Response types</summary>
{{$responses := false}}
{{range $s := $e.Stmt}}{{$diagram := CreateReturnDataModel  $appName $s $e}}{{if ne $diagram ""}}
{{$responses = true}}
{{$ret := (GetReturnType $e $s)}}{{if $ret }}
{{Attribute $ret "description"}}{{end}}
<img src="{{$diagram}}">
{{end}}{{end}}
{{if not $responses}}
<span style="color:grey">No Response Types</span>
{{end}}
</details>

{{end}}
---
{{end}}{{end}}{{end}}{{end}}{{end}}{{end}}
{{if $anyTypes}}
# Types
{{range $appName := SortedKeys .Apps}}{{$app := index $Apps $appName}}{{$types := $app.Types}}
{{if ne (hasPattern $app.Attrs "db") true}}
{{range $typeName := SortedKeys $types}}{{$type := index $types $typeName}}
<a name={{$appName}}.{{$typeName}}></a><details>
<summary>{{$appName}}.{{$typeName}}</summary>

### {{$appName}}.{{$typeName}}

{{$typedesc := (Attribute $type "description")}}
{{if ne $typedesc ""}}- {{$typedesc}}{{end}}
<img src="{{CreateTypeDiagram $appName $typeName $type false}}">
<a href="{{CreateTypeDiagram $appName $typeName $type true}}">Full Diagram</a>
{{if Fields $type}}

#### Fields

{{$fieldHeader := false}}
{{$fieldMap := Fields $type}}{{range $fieldName := SortedKeys $fieldMap}}{{$field := index $fieldMap $fieldName}}{{if not $fieldHeader}}| Field name | Type | Description |
|----|----|----|{{$fieldHeader = true}}{{end}}
| {{$fieldName}} | {{FieldType $field}} | {{$desc := Attribute $field "description"}}{{if ne $desc $typedesc}}{{$desc}}{{end}}|{{end}}
{{end}}
</details>{{end}}{{end}}{{end}}
{{end}}
<div class="footer">
